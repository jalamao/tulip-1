ADD_SUBDIRECTORY(stl)
ADD_SUBDIRECTORY(tulip-core)
ADD_SUBDIRECTORY(tulip-ogl)
ADD_SUBDIRECTORY(tulip-gui)

# When building Python wheels on windows, we need to copy the dll dependencies
# required to import the tulip modules in the wheels folders
IF(WIN32 AND ACTIVATE_PYTHON_WHEELS_TARGETS)

# Base System
# Libs needed to provide sufficient runtime under Windows environments
  IF(MINGW)

    # base runtime
    COPY_EXTERNAL_LIB("libgcc_s_*.dll" ${TULIP_PYTHON_NATIVE_FOLDER})
    COPY_EXTERNAL_LIB("libstdc++-*.dll" ${TULIP_PYTHON_NATIVE_FOLDER})

    # install libintl and its dependency libiconv if found in the MinGW build environment
    IF(INTL_LIBRARY)

      COPY_EXTERNAL_LIB("*intl*.dll" ${TULIP_PYTHON_NATIVE_FOLDER})
      COPY_EXTERNAL_LIB("*iconv*.dll" ${TULIP_PYTHON_NATIVE_FOLDER})

    ENDIF(INTL_LIBRARY)

    # install pthread lib in all cases as it is a frequent dependency

    COPY_EXTERNAL_LIB("*pthread*.dll" ${TULIP_PYTHON_NATIVE_FOLDER})

    # OpenMP runtime
    IF(OPENMP_FOUND)

      COPY_EXTERNAL_LIB("libgomp-*.dll" ${TULIP_PYTHON_NATIVE_FOLDER})

    ENDIF(OPENMP_FOUND)

  ENDIF(MINGW)

  COPY_EXTERNAL_LIB_IF_NEEDED(${ZLIB_LIBRARY} ${TULIP_PYTHON_NATIVE_FOLDER})

  IF(NOT BUILD_CORE_ONLY)

    COPY_EXTERNAL_LIB_IF_NEEDED(${GLEW_LIBRARY} ${TULIPOGL_PYTHON_NATIVE_FOLDER})
    COPY_EXTERNAL_LIB_IF_NEEDED(${FREETYPE_LIBRARY} ${TULIPOGL_PYTHON_NATIVE_FOLDER})
    COPY_EXTERNAL_LIB_IF_NEEDED(${JPEG_LIBRARY} ${TULIPOGL_PYTHON_NATIVE_FOLDER})
    COPY_EXTERNAL_LIB_IF_NEEDED(${PNG_LIBRARY} ${TULIPOGL_PYTHON_NATIVE_FOLDER})

    COPY_EXTERNAL_LIB("QtCore4.dll" ${TULIPGUI_PYTHON_NATIVE_FOLDER})
    COPY_EXTERNAL_LIB("QtGui4.dll" ${TULIPGUI_PYTHON_NATIVE_FOLDER})
    COPY_EXTERNAL_LIB("QtNetwork4.dll" ${TULIPGUI_PYTHON_NATIVE_FOLDER})
    COPY_EXTERNAL_LIB("QtOpenGL4.dll" ${TULIPGUI_PYTHON_NATIVE_FOLDER})
    COPY_EXTERNAL_LIB("QtXml4.dll" ${TULIPGUI_PYTHON_NATIVE_FOLDER})
    COPY_EXTERNAL_LIB("QtWebKit4.dll" ${TULIPGUI_PYTHON_NATIVE_FOLDER})

    IF(QT_PHONON_LIBRARY)

      COPY_EXTERNAL_LIB("phonon4.dll" ${TULIPGUI_PYTHON_NATIVE_FOLDER})

    ENDIF(QT_PHONON_LIBRARY)

  ENDIF(NOT BUILD_CORE_ONLY)

ENDIF(WIN32 AND ACTIVATE_PYTHON_WHEELS_TARGETS)

# When building Python wheels on MacOS, copy dependencies dylibs in wheels folders.
# They will be distributed and relinked when generating the wheels.
IF(APPLE AND ACTIVATE_PYTHON_WHEELS_TARGETS AND NOT BUILD_CORE_ONLY)

  COPY_REAL_LIB(${FREETYPE_LIBRARY} ${TULIPOGL_PYTHON_NATIVE_FOLDER})
  COPY_REAL_LIB(${GLEW_LIBRARY} ${TULIPOGL_PYTHON_NATIVE_FOLDER})
  COPY_REAL_LIB(${JPEG_LIBRARY} ${TULIPOGL_PYTHON_NATIVE_FOLDER})
  COPY_REAL_LIB(${PNG_LIBRARY_RELEASE} ${TULIPOGL_PYTHON_NATIVE_FOLDER})
  COPY_REAL_LIB(${FREETYPE_LIBRARY} ${TULIPOGL_PYTHON_NATIVE_FOLDER})
  COPY_REAL_LIB(${QT_QTCORE_LIBRARY}/QtCore ${TULIPGUI_PYTHON_NATIVE_FOLDER})
  COPY_REAL_LIB(${QT_QTGUI_LIBRARY}/QtGui ${TULIPGUI_PYTHON_NATIVE_FOLDER})
  COPY_REAL_LIB(${QT_QTNETWORK_LIBRARY}/QtNetwork ${TULIPGUI_PYTHON_NATIVE_FOLDER})
  COPY_REAL_LIB(${QT_QTXML_LIBRARY}/QtXml ${TULIPGUI_PYTHON_NATIVE_FOLDER})
  COPY_REAL_LIB(${QT_QTOPENGL_LIBRARY}/QtOpenGL ${TULIPGUI_PYTHON_NATIVE_FOLDER})
  COPY_REAL_LIB(${QT_QTWEBKIT_LIBRARY}/QtWebKit ${TULIPGUI_PYTHON_NATIVE_FOLDER})
  COPY_REAL_LIB(${QT_QTXMLPATTERNS_LIBRARY}/QtXmlPatterns ${TULIPGUI_PYTHON_NATIVE_FOLDER})
  COPY_REAL_LIB(${QT_PHONON_LIBRARY}/phonon ${TULIPGUI_PYTHON_NATIVE_FOLDER})
  COPY_REAL_LIB(${QT_QTDBUS_LIBRARY}/QtDBus ${TULIPGUI_PYTHON_NATIVE_FOLDER})

ENDIF(APPLE AND ACTIVATE_PYTHON_WHEELS_TARGETS AND NOT BUILD_CORE_ONLY)
